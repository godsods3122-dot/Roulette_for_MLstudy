<!DOCTYPE html>
<html lang="ko">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>ìŠ¤í„°ë”” ì—­í•  ë¶„ë‹´ ìŠ¬ë¡¯ ë¨¸ì‹ </title>

Â  Â  <script type="module">
Â  Â  Â  Â  // Firebase v9+ (ëª¨ë“ˆ ë°©ì‹)
Â  Â  Â  Â  // query, limitToLast, orderByChildë¥¼ importì— ì¶”ê°€
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
Â  Â  Â  Â  import { getDatabase, ref, get, set, update, push, query, limitToLast, orderByChild } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // --- ìš”ì²­í•˜ì‹  Firebase ì„¤ì •(config) ê°ì²´ ---
Â  Â  Â  Â  const firebaseConfig = {
Â  Â  Â  Â  Â  Â  apiKey: "AIzaSyDLwzXcJw0dDuOR7F76MQvZQ9NoY2hH3bQ",
Â  Â  Â  Â  Â  Â  authDomain: "roulette-data-4f5bf.firebaseapp.com",
Â  Â  Â  Â  Â  Â  projectId: "roulette-data-4f5bf",
Â  Â  Â  Â  Â  Â  storageBucket: "roulette-data-4f5bf.firebasestorage.app",
Â  Â  Â  Â  Â  Â  messagingSenderId: "282079852816",
Â  Â  Â  Â  Â  Â  appId: "1:282079852816:web:c02c711169a47bf9230d95",
Â  Â  Â  Â  Â  Â  measurementId: "G-FJ93Z9BKJQ",
Â  Â  Â  Â  Â  Â  databaseURL: "https://roulette-data-4f5bf-default-rtdb.firebaseio.com/"
Â  Â  Â  Â  };
Â  Â  Â  Â  // -----------------------------------------

Â  Â  Â  Â  // Firebase ì•± ì´ˆê¸°í™” ë° ë°ì´í„°ë² ì´ìŠ¤ ì°¸ì¡° ì „ì—­í™”
Â  Â  Â  Â  const app = initializeApp(firebaseConfig);
Â  Â  Â  Â  const db = getDatabase(app);

Â  Â  Â  Â  // ìŠ¤í¬ë¦½íŠ¸ì˜ ë‹¤ë¥¸ ë¶€ë¶„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ window ê°ì²´ì— í• ë‹¹
Â  Â  Â  Â  window.firebaseDB = { db, ref, get, set, update, push, query, limitToLast, orderByChild };
Â  Â  </script>

Â  Â  <style>
Â  Â  Â  Â  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500;700&display=swap');
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --surface-color: transparent;
Â  Â  Â  Â  Â  Â  --primary-color: #c792ea;
Â  Â  Â  Â  Â  Â  --gradient-start: #b39ddb;
Â  Â  Â  Â  Â  Â  --gradient-end: #8e8dcc;
Â  Â  Â  Â  Â  Â  --text-color-dark: #2c2c2c;
Â  Â  Â  Â  Â  Â  --text-color-active: #ffffff;
Â  Â  Â  Â  Â  Â  --text-color-inactive: #d1c4e9;
Â  Â  Â  Â  Â  Â  --border-color: #5e5a81;
Â  Â  Â  Â  Â  Â  --input-bg-color: #2e2a4f;
Â  Â  Â  Â  }
Â  Â  Â  Â  html { font-size: 15px; }
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  font-family: 'Noto Sans KR', sans-serif;
Â  Â  Â  Â  Â  Â  background-color: transparent;
Â  Â  Â  Â  Â  Â  color: var(--text-color-active);
Â  Â  Â  Â  Â  Â  -webkit-font-smoothing: antialiased;
Â  Â  Â  Â  Â  Â  -moz-osx-font-smoothing: grayscale;
Â  Â  Â  Â  Â  Â  margin: 0; padding: 0;
Â  Â  Â  Â  }
Â  Â  Â  Â  .container { background-color: var(--surface-color); padding: 20px; text-align: center; }
Â  Â  Â  Â  h1 {
Â  Â  Â  Â  Â  Â  color: var(--primary-color);
Â  Â  Â  Â  Â  Â  margin-top: 0; margin-bottom: 30px;
Â  Â  Â  Â  Â  Â  font-weight: 700; font-size: 1.8em;
Â  Â  Â  Â  }
Â  Â  Â  Â  .slot-machine { display: flex; justify-content: space-around; margin-bottom: 25px; gap: 20px; }
Â  Â  Â  Â  .role { width: 48%; }
Â  Â  Â  Â  .role h2 { font-size: 1.1em; color: var(--text-color-inactive); margin-bottom: 10px; font-weight: 500; }
Â  Â  Â  Â  .slot-window {
Â  Â  Â  Â  Â  Â  background: linear-gradient(45deg, var(--gradient-start), var(--gradient-end));
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  height: 60px;
Â  Â  Â  Â  Â  Â  font-size: 1.7em;
Â  Â  Â  Â  Â  Â  font-weight: 700;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  }
Â  Â  Â  Â  .slot-reel { position: absolute; top: 0; left: 0; right: 0; transition: none; }
Â  Â  Â  Â  .reel-item {
Â  Â  Â  Â  Â  Â  height: 60px;
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .reel-item.active { color: var(--text-color-active); }
Â  Â  Â  Â  #spin-button {
Â  Â  Â  Â  Â  Â  background-color: var(--primary-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color-active);
Â  Â  Â  Â  Â  Â  border: none; padding: 12px 25px;
Â  Â  Â  Â  Â  Â  font-size: 1.1em; font-weight: 700;
Â  Â  Â  Â  Â  Â  border-radius: 8px; cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease; width: 100%;
Â  Â  Â  Â  }
Â  Â  Â  Â  #spin-button:hover:not(:disabled) { background-color: #d09ff0; }
Â  Â  Â  Â  #spin-button:disabled { background-color: var(--border-color); cursor: not-allowed; opacity: 0.7; }
Â  Â  Â  Â  .password-wrapper { margin-top: 15px; margin-bottom: 25px; }
Â  Â  Â  Â  #admin-password {
Â  Â  Â  Â  Â  Â  background-color: var(--input-bg-color);
Â  Â  Â  Â  Â  Â  border: 1px solid var(--border-color);
Â  Â  Â  Â  Â  Â  color: var(--text-color-active);
Â  Â  Â  Â  Â  Â  border-radius: 6px; padding: 8px 12px;
Â  Â  Â  Â  Â  Â  text-align: center; width: 150px;
Â  Â  Â  Â  Â  Â  font-size: 1em; font-family: inherit;
Â  Â  Â  Â  }
Â  Â  Â  Â  #admin-password:focus { outline: none; border-color: var(--primary-color); }
Â  Â  Â  Â  .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
Â  Â  Â  Â  @keyframes shake {
Â  Â  Â  Â  Â  Â  10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); }
Â  Â  Â  Â  Â  Â  30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .candidate-info-wrapper { display: flex; justify-content: space-around; gap: 15px; }
Â  Â  Â  Â  .candidate-info { background-color: transparent; padding: 0; width: 48%; flex-direction: column; }
Â  Â  Â  Â  .candidate-info h3 { margin: 0 0 8px 0; color: var(--text-color-inactive); font-size: 0.9em; font-weight: 500; text-align: left;}
Â  Â  Â  Â  .candidate-list { display: flex; flex-wrap: wrap; gap: 8px; min-height: 35px; margin:0; padding: 0; }
Â  Â  Â  Â  .candidate-tag {
Â  Â  Â  Â  Â  Â  padding: 6px 12px; margin: 0;
Â  Â  Â  Â  Â  Â  border-radius: 15px; font-size: 0.95em;
Â  Â  Â  Â  Â  Â  font-weight: 700; color: var(--text-color-dark);
Â  Â  Â  Â  Â  Â  transition: opacity 0.5s ease-out, transform 0.5s ease-out, margin-right 0.5s ease-in-out;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>
Â  Â  <div class="container">
Â  Â  Â  Â  <h1>ì´ë²ˆ ì£¼ ìŠ¤í„°ë”” ë‹¹ë²ˆ ë½‘ê¸° ğŸ°</h1>
Â  Â  Â  Â  <div class="slot-machine">
Â  Â  Â  Â  Â  Â  <div class="role">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>ğŸ‘‘ ë¦¬ë”</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot-window"><div id="leader-reel" class="slot-reel"></div></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="role">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>âœï¸ ë…¸íŠ¸ í…Œì´ì»¤</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="slot-window"><div id="notetaker-reel" class="slot-reel"></div></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button id="spin-button">SPIN!</button>
Â  Â  Â  Â  <div class="password-wrapper">
Â  Â  Â  Â  Â  Â  <input type="password" id="admin-password" placeholder="Admin Password">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="candidate-info-wrapper">
Â  Â  Â  Â  Â  Â  <div class="candidate-info">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ë‚¨ì€ ë¦¬ë” í›„ë³´</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="leader-candidate-list" class="candidate-list"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="candidate-info">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ë‚¨ì€ ë…¸íŠ¸ í…Œì´ì»¤ í›„ë³´</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="notetaker-candidate-list" class="candidate-list"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  const ALL_LEADERS = ['ê¹€ì„±ì›', 'ê¹€ëª…ì„', 'ë°•ì§€ì›'];
Â  Â  Â  Â  Â  Â  const ALL_NOTE_TAKERS = ['ê¹€ì„±ì›', 'ê¹€ëª…ì„', 'ë°•ì§€ì›'];
Â  Â  Â  Â  Â  Â  const ADMIN_PASSWORD = '0503';
Â  Â  Â  Â  Â  Â  const REEL_ITEM_HEIGHT = 60;
Â  Â  Â  Â  Â  Â  const REEL_REPEAT_COUNT = 5;
Â  Â  Â  Â  Â  Â  const PASTEL_COLORS = ['#ffadad', '#ffd6a5', '#fdffb6', '#caffbf', '#9bf6ff', '#a0c4ff', '#bdb2ff', '#ffc6ff'];

Â  Â  Â  Â  Â  Â  const UIElements = {
Â  Â  Â  Â  Â  Â  Â  Â  leaderReel: document.getElementById('leader-reel'),
Â  Â  Â  Â  Â  Â  Â  Â  notetakerReel: document.getElementById('notetaker-reel'),
Â  Â  Â  Â  Â  Â  Â  Â  spinButton: document.getElementById('spin-button'),
Â  Â  Â  Â  Â  Â  Â  Â  leaderCandidateDisplay: document.getElementById('leader-candidate-list'),
Â  Â  Â  Â  Â  Â  Â  Â  notetakerCandidateDisplay: document.getElementById('notetaker-candidate-list'),
Â  Â  Â  Â  Â  Â  Â  Â  passwordInput: document.getElementById('admin-password'),
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // ë¡œì»¬ ìƒíƒœ ê°ì²´ì— ë§ˆì§€ë§‰ ë‹¹ì²¨ì ì •ë³´ ì¶”ê°€
Â  Â  Â  Â  Â  Â  let state = {
Â  Â  Â  Â  Â  Â  Â  Â  availableLeaders: [],
Â  Â  Â  Â  Â  Â  Â  Â  availableNoteTakers: [],
Â  Â  Â  Â  Â  Â  Â  Â  lastLeader: null,
Â  Â  Â  Â  Â  Â  Â  Â  lastNoteTaker: null
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  // --- Firebase ì—°ë™ í•¨ìˆ˜ ---
Â  Â  Â  Â  Â  Â  async function loadDataFromFirebase() {
Â  Â  Â  Â  Â  Â  Â  Â  const { db, ref, get, set, query, limitToLast } = window.firebaseDB;
Â  Â  Â  Â  Â  Â  Â  Â  const dbRef = ref(db, 'studyRoles');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 1. í›„ë³´ì ëª…ë‹¨ ê°€ì ¸ì˜¤ê¸°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const snapshot = await get(dbRef);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (snapshot.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = snapshot.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.availableLeaders = data.availableLeaders || [...ALL_LEADERS];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.availableNoteTakers = data.availableNoteTakers || [...ALL_NOTE_TAKERS];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // 2. â˜…â˜…â˜… ë§ˆì§€ë§‰ ë‹¹ì²¨ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ìˆ˜ì •ëœ ë¶€ë¶„) â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const resultsRef = ref(db, 'studyRoles/results');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastResultQuery = query(resultsRef, limitToLast(1));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const resultSnapshot = await get(lastResultQuery);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (resultSnapshot.exists()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const resultsData = resultSnapshot.val();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastResultKey = Object.keys(resultsData)[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastResult = resultsData[lastResultKey];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.lastLeader = lastResult.leader;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.lastNoteTaker = lastResult.noteTaker;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ì´ˆê¸° ìƒíƒœë¡œ ì„¤ì •í•˜ê³  DBì— ì €ì¥
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.availableLeaders = [...ALL_LEADERS];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.availableNoteTakers = [...ALL_NOTE_TAKERS];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await set(dbRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  availableLeaders: state.availableLeaders,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  availableNoteTakers: state.availableNoteTakers
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase ë°ì´í„° ë¡œë”© ì—ëŸ¬:", error);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.availableLeaders = [...ALL_LEADERS];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.availableNoteTakers = [...ALL_NOTE_TAKERS];
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // UI ì—…ë°ì´íŠ¸
Â  Â  Â  Â  Â  Â  Â  Â  displayCandidates(UIElements.leaderCandidateDisplay, state.availableLeaders);
Â  Â  Â  Â  Â  Â  Â  Â  displayCandidates(UIElements.notetakerCandidateDisplay, state.availableNoteTakers);
Â  Â  Â  Â  Â  Â  Â  Â  setupInitialReels();
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  async function updateFirebaseData(newLeaderList, newNoteTakerList, winnerLeader, winnerNoteTaker) {
Â  Â  Â  Â  Â  Â  Â  Â  const { db, ref, update, push } = window.firebaseDB;
Â  Â  Â  Â  Â  Â  Â  Â  const dbRef = ref(db, 'studyRoles');
Â  Â  Â  Â  Â  Â  Â  Â  const resultsRef = ref(db, 'studyRoles/results');
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const newResult = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  leader: winnerLeader,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  noteTaker: winnerNoteTaker,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: new Date().toISOString()
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await update(dbRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  availableLeaders: newLeaderList,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  availableNoteTakers: newNoteTakerList
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await push(resultsRef, newResult);
Â  Â  Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase ë°ì´í„° ì—…ë°ì´íŠ¸ ì—ëŸ¬:", error);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  // --- UI ë° ë¡œì§ í•¨ìˆ˜ë“¤ ---
Â  Â  Â  Â  Â  Â  function displayCandidates(container, names) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  const shuffledColors = [...PASTEL_COLORS].sort(() => 0.5 - Math.random());
Â  Â  Â  Â  Â  Â  Â  Â  names.forEach((name, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tag = document.createElement('span');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag.className = 'candidate-tag';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag.textContent = name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag.dataset.name = name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag.style.backgroundColor = shuffledColors[index % shuffledColors.length];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(tag);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function animateRemoval(container, name) {
Â  Â  Â  Â  Â  Â  Â  Â  return new Promise(resolve => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tag = container.querySelector(`[data-name="${name}"]`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (tag) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const tagWidth = tag.offsetWidth;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag.style.opacity = '0';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag.style.transform = 'scale(0.8)';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tag.style.marginRight = `-${tagWidth + 8}px`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { tag.remove(); resolve(); }, 500);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { resolve(); }
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const shuffle = (array) => array.sort(() => Math.random() - 0.5);

Â  Â  Â  Â  Â  Â  function setupReel(reelElement, candidates, initialWinner = null) {
Â  Â  Â  Â  Â  Â  Â  Â  reelElement.innerHTML = '';
Â  Â  Â  Â  Â  Â  Â  Â  if (candidates.length === 0 && !initialWinner) return [];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  // í›„ë³´ì ëª…ë‹¨ì— ë§ˆì§€ë§‰ ë‹¹ì²¨ìê°€ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸ í›„, ì—†ìœ¼ë©´ ì¶”ê°€
Â  Â  Â  Â  Â  Â  Â  Â  let displayCandidates = [...candidates];
Â  Â  Â  Â  Â  Â  Â  Â  if (initialWinner && !displayCandidates.includes(initialWinner)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayCandidates.push(initialWinner);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if(displayCandidates.length === 0) return [];
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const shuffled = shuffle(displayCandidates);
Â  Â  Â  Â  Â  Â  Â  Â  const extendedReel = Array(REEL_REPEAT_COUNT).fill(shuffled).flat();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  extendedReel.forEach(name => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const item = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.className = 'reel-item';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.textContent = name;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reelElement.appendChild(item);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  return extendedReel;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // â˜…â˜…â˜… ë£°ë › ì´ˆê¸° í™”ë©´ ì„¤ì • í•¨ìˆ˜ (ìˆ˜ì •ë¨) â˜…â˜…â˜…
Â  Â  Â  Â  Â  Â  function setupInitialReels() {
Â  Â  Â  Â  Â  Â  Â  Â  // ë¦¬ë” ë¦´ ì„¤ì •
Â  Â  Â  Â  Â  Â  Â  Â  const leaderReelItems = setupReel(UIElements.leaderReel, state.availableLeaders, state.lastLeader);
Â  Â  Â  Â  Â  Â  Â  Â  if (leaderReelItems.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const winner = state.lastLeader || leaderReelItems[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const winnerIndex = leaderReelItems.indexOf(winner);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UIElements.leaderReel.style.top = `-${winnerIndex * REEL_ITEM_HEIGHT}px`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UIElements.leaderReel.children[winnerIndex]?.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // ë…¸íŠ¸í…Œì´ì»¤ ë¦´ ì„¤ì •
Â  Â  Â  Â  Â  Â  Â  Â  const notetakerReelItems = setupReel(UIElements.notetakerReel, state.availableNoteTakers, state.lastNoteTaker);
Â  Â  Â  Â  Â  Â  Â  Â  if (notetakerReelItems.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const winner = state.lastNoteTaker || notetakerReelItems[0];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const winnerIndex = notetakerReelItems.indexOf(winner);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UIElements.notetakerReel.style.top = `-${winnerIndex * REEL_ITEM_HEIGHT}px`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UIElements.notetakerReel.children[winnerIndex]?.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  function runSpin(reelElement, fullReel, winner) {
Â  Â  Â  Â  Â  Â  Â  Â  return new Promise(resolve => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ë‹¹ì²¨ìê°€ ë¦´ì˜ ë§ˆì§€ë§‰ ë¶€ë¶„ì— ìœ„ì¹˜í•˜ë„ë¡ ì¸ë±ìŠ¤ ê³„ì‚°
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const winnerBaseIndex = fullReel.lastIndexOf(winner);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const targetTop = -winnerBaseIndex * REEL_ITEM_HEIGHT;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const spinDuration = 3000 + Math.random() * 1000;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Array.from(reelElement.children).forEach(child => child.classList.remove('active'));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reelElement.children[winnerBaseIndex]?.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reelElement.style.transition = `top ${spinDuration}ms cubic-bezier(0.25, 0.1, 0.25, 1)`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reelElement.style.top = `${targetTop}px`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reelElement.addEventListener('transitionend', () => resolve(), { once: true });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  function checkPassword() {
Â  Â  Â  Â  Â  Â  Â  Â  if (UIElements.passwordInput.value !== ADMIN_PASSWORD) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UIElements.passwordInput.classList.add('shake');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => UIElements.passwordInput.classList.remove('shake'), 500);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  return true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  async function selectRoles() {
Â  Â  Â  Â  Â  Â  Â  Â  if (!checkPassword()) return;

Â  Â  Â  Â  Â  Â  Â  Â  UIElements.spinButton.disabled = true;

Â  Â  Â  Â  Â  Â  Â  Â  if (state.availableLeaders.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  state.availableLeaders = [...ALL_LEADERS];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayCandidates(UIElements.leaderCandidateDisplay, state.availableLeaders);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  let tempNoteTakerCandidates = [...state.availableNoteTakers];
Â  Â  Â  Â  Â  Â  Â  Â  if (tempNoteTakerCandidates.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempNoteTakerCandidates = [...ALL_NOTE_TAKERS];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayCandidates(UIElements.notetakerCandidateDisplay, tempNoteTakerCandidates);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const finalLeader = state.availableLeaders[Math.floor(Math.random() * state.availableLeaders.length)];
Â  Â  Â  Â  Â  Â  Â  Â  let validNoteTakerCandidates = tempNoteTakerCandidates.filter(name => name !== finalLeader);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (validNoteTakerCandidates.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tempNoteTakerCandidates = [...ALL_NOTE_TAKERS];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  validNoteTakerCandidates = tempNoteTakerCandidates.filter(name => name !== finalLeader);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayCandidates(UIElements.notetakerCandidateDisplay, tempNoteTakerCandidates);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const finalNoteTaker = validNoteTakerCandidates[Math.floor(Math.random() * validNoteTakerCandidates.length)];

Â  Â  Â  Â  Â  Â  Â  Â  const leaderReelItems = setupReel(UIElements.leaderReel, state.availableLeaders);
Â  Â  Â  Â  Â  Â  Â  Â  const notetakerReelItems = setupReel(UIElements.notetakerReel, tempNoteTakerCandidates);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(requestAnimationFrame);

Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all([
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  runSpin(UIElements.leaderReel, leaderReelItems, finalLeader),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  runSpin(UIElements.notetakerReel, notetakerReelItems, finalNoteTaker),
Â  Â  Â  Â  Â  Â  Â  Â  ]);

Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(resolve => setTimeout(resolve, 1000));

Â  Â  Â  Â  Â  Â  Â  Â  await Promise.all([
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  animateRemoval(UIElements.leaderCandidateDisplay, finalLeader),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  animateRemoval(UIElements.notetakerCandidateDisplay, finalNoteTaker)
Â  Â  Â  Â  Â  Â  Â  Â  ]);

Â  Â  Â  Â  Â  Â  Â  Â  const updatedLeaders = state.availableLeaders.filter(name => name !== finalLeader);
Â  Â  Â  Â  Â  Â  Â  Â  const updatedNoteTakers = tempNoteTakerCandidates.filter(name => name !== finalNoteTaker);
Â  Â  Â  Â  Â  Â  Â  Â  state.availableLeaders = updatedLeaders;
Â  Â  Â  Â  Â  Â  Â  Â  state.availableNoteTakers = updatedNoteTakers;
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  await updateFirebaseData(updatedLeaders, updatedNoteTakers, finalLeader, finalNoteTaker);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  UIElements.spinButton.disabled = false;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  UIElements.spinButton.addEventListener('click', selectRoles);
Â  Â  Â  Â  Â  Â  loadDataFromFirebase();
Â  Â  Â  Â  });
Â  Â  </script>
</body>
</html>

ì˜ˆì „ì— firebase ê·œì¹™ì„ ìˆ˜ì •í•˜ì§€ ì•Šìœ¼ë©´ ë°ì´í„° ì½ê¸°ë¥¼ ì°¨ë‹¨í•˜ê¸° ì‹œì‘í•œë‹¤ê³  í•˜ë˜ë°, ê²°êµ­ì—” ë°ì´í„°ê°€ ì•ˆ ì½ì–´ì ¸. ì´ê±¸ ì–´ë–»ê²Œ ê³ ì¹  ìˆ˜ ìˆì§€? ë„¤ê°€ ë§Œë“  ì½”ë“ ë° ì¢€ ê³ ì³ë´. ë°ì´í„°ê°€ ì•ˆ ì½ì–´ì ¸ì„œ ë¬¸ì œê°€ ìê¾¸ ìƒê¸´ë‹¤
